- name: create work dir
  become_user: "{{ user }}"
  file:
    path: "~/work/ansible_app_install"
    state: directory
    owner: "{{ user }}"
    group: "{{ group }}"
    mode: 0755

- name: copy install script
  become_user: "{{ user }}"
  copy:
    src: "install.sh"
    dest: "~/work/ansible_app_install"
    owner: "{{ user }}"
    group: "{{ group }}"
    mode: 0755

- name: install from nix
  become_user: "{{ user }}"
  shell: "~/work/ansible_app_install/install.sh {{ item }}"
  with_items:
    - "ansible"
    - "sshpass"
    - "tmux"
#    - "docker"
    - "helm-2.14.2"
    - "terraform"
    - "emacs"
    - "elixir"
    - "python3-3.7.4"
    - "python3.7-pip-19.1.1"
    - "fish"
    - "scala"
    - "sbt"
    - "nodejs"
    - "reattach-to-user-namespace"
    - "graphviz"
    - "peco"
    - "jq"
    - "rustc"
    - "cargo"

- name: nix gc
  become_user: "{{ user }}"
  command: "~/.nix-profile/bin/nix-store --gc"
